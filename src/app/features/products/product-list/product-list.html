<!-- product-list.component.html - SIGNAL-BASED VERSION -->
<app-header></app-header>
<div class="container-fluid mt-4 content-wrapper">
  <!-- Stats Overview with Enhanced Design -->
  <div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-4">
      <div class="stats-card">
        <div class="d-flex justify-content-between align-items-start">
          <div style="position: relative; z-index: 2">
            <div class="stats-label">สินค้าทั้งหมด</div>
            <div class="stats-number">{{ stats().totalProducts }}</div>
            <div class="mt-2 stats-sub">
              <i class="fas fa-arrow-up me-1"></i> {{ stats().productGrowth }} จากเดือนที่แล้ว
            </div>
          </div>
          <i class="fas fa-boxes stats-icon"></i>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
      <div class="stats-card">
        <div class="d-flex justify-content-between align-items-start">
          <div style="position: relative; z-index: 2">
            <div class="stats-label">สินค้าคงเหลือต่ำ</div>
            <div class="stats-number">{{ stats().lowStockItems }}</div>
            <div class="mt-2 stats-sub">
              <i class="fas fa-exclamation-triangle me-1"></i> ต้องเติมสต็อก
            </div>
          </div>
          <i class="fas fa-exclamation-triangle stats-icon"></i>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
      <div class="stats-card">
        <div class="d-flex justify-content-between align-items-start">
          <div style="position: relative; z-index: 2">
            <div class="stats-label">หมวดหมู่</div>
            <div class="stats-number">{{ stats().categories }}</div>
            <div class="mt-2 stats-sub">
              <i class="fas fa-check-circle me-1"></i> ครบถ้วน
            </div>
          </div>
          <i class="fas fa-layer-group stats-icon"></i>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
      <div class="stats-card">
        <div class="d-flex justify-content-between align-items-start">
          <div style="position: relative; z-index: 2">
            <div class="stats-label">มูลค่าคงคลัง</div>
            <div class="stats-number">{{ stats().inventoryValue }}</div>
            <div class="mt-2 stats-sub">
              <i class="fas fa-chart-line me-1"></i> เติบโต {{ stats().valueGrowth }}
            </div>
          </div>
          <i class="fas fa-coins stats-icon"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Search and Filter Section -->
  <div class="search-glass">
    <div class="row g-3 align-items-end" style="position: relative; z-index: 2">
      <div class="col-md-4">
        <label class="form-label-glass">
          <i class="fas fa-search me-2"></i>ค้นหาสินค้า
        </label>
        <div class="input-group">
          <span class="input-group-text-glass">
            <i class="fas fa-search"></i>
          </span>
          <input
            type="text"
            class="form-control-glass"
            placeholder="ชื่อสินค้า, SKU, รหัสสินค้า..."
            [ngModel]="searchText()"
            (ngModelChange)="searchText.set($event)"
          />
        </div>
      </div>

      <div class="col-md-3">
        <label class="form-label-glass">
          <i class="fas fa-layer-group me-2"></i>หมวดหมู่
        </label>
        <select
          class="form-select-glass"
          [ngModel]="selectedCategory()"
          (ngModelChange)="selectedCategory.set($event)"
        >
          <option>ทั้งหมด</option>
          <option>อิเล็กทรอนิกส์</option>
          <option>เสื้อผ้า</option>
          <option>อาหารและเครื่องดื่ม</option>
          <option>เครื่องใช้ในบ้าน</option>
        </select>
      </div>

      <div class="col-md-2">
        <label class="form-label-glass">
          <i class="fas fa-toggle-on me-2"></i>สถานะ
        </label>
        <select
          class="form-select-glass"
          [ngModel]="selectedStatus()"
          (ngModelChange)="selectedStatus.set($event)"
        >
          <option>ทั้งหมด</option>
          <option>เปิดใช้งาน</option>
          <option>ปิดใช้งาน</option>
          <option>สินค้าหมด</option>
        </select>
      </div>

      <div class="col-md-3">
        <button class="btn btn-premium btn-premium-primary w-100" (click)="applyFilters()">
          <i class="fas fa-filter me-2"></i><span>กรองผลลัพธ์</span>
        </button>
      </div>
    </div>

    <div class="row mt-4" style="position: relative; z-index: 2">
      <div class="col-12">
        <button class="btn btn-premium btn-premium-success" (click)="addNewProduct()">
          <i class="fas fa-plus-circle me-2"></i><span>เพิ่มสินค้าใหม่</span>
        </button>
        <button class="btn btn-premium btn-premium-outline ms-2">
          <i class="fas fa-file-export me-2"></i><span>ส่งออก Excel</span>
        </button>
        <button class="btn btn-premium btn-premium-outline ms-2">
          <i class="fas fa-print me-2"></i><span>พิมพ์รายงาน</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Enhanced Product Grid with @for loop -->
  <div class="row">
    @for (product of filteredProducts(); track product.id) {
      <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
        <div class="product-card">
          <div class="product-image-wrapper">
            <img
              [src]="product.imageUrl"
              class="product-image"
              [alt]="product.name"
            />
            <div class="product-overlay"></div>
            <span class="badge-status" [ngClass]="getStatusBadgeClass(product)">
              <i class="fas {{ getStatusIcon(product) }} me-1"></i>{{ getStatusText(product) }}
            </span>
          </div>

          <div class="product-body">
            <div class="mb-2">
              <span class="category-badge">
                <i class="fas {{ product.categoryIcon }} me-1"></i>{{ product.category }}
              </span>
              <small class="product-sku ms-2">
                <i class="fas fa-barcode me-1"></i>{{ product.sku }}
              </small>
            </div>

            <h5 class="product-title">{{ product.name }}</h5>
            <p class="product-description">
              <i class="fas fa-info-circle me-1"></i>{{ product.description }}
            </p>

            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="price-tag">฿{{ product.price.toLocaleString() }}</span>
              <span class="stock-indicator" [style.color]="getStockColor(product.stock)">
                <i class="fas {{ getStockIcon(product.stock) }} me-1"></i> {{ product.stock }}
              </span>
            </div>

            <div class="d-grid gap-2">
              <button class="btn btn-edit" (click)="editProduct(product.id)">
                <i class="fas fa-edit me-2"></i>แก้ไขสินค้า
              </button>
            </div>
          </div>
        </div>
      </div>
    }

    @if (filteredProducts().length === 0) {
      <div class="col-12">
        <div class="alert alert-info text-center">
          <i class="fas fa-info-circle me-2"></i>
          ไม่พบสินค้าที่ตรงกับการค้นหา
        </div>
      </div>
    }
  </div>

  <!-- Enhanced Pagination -->
  <div class="row mt-5 mb-5">
    <div class="col-12">
      <nav>
        <ul class="pagination justify-content-center pagination-glass">
          <li class="page-item disabled">
            <a class="page-link">
              <i class="fas fa-chevron-left me-2"></i>ก่อนหน้า
            </a>
          </li>
          <li class="page-item active">
            <a class="page-link">1</a>
          </li>
          <li class="page-item">
            <a class="page-link">2</a>
          </li>
          <li class="page-item">
            <a class="page-link">3</a>
          </li>
          <li class="page-item">
            <a class="page-link">4</a>
          </li>
          <li class="page-item">
            <a class="page-link">5</a>
          </li>
          <li class="page-item">
            <a class="page-link">
              ถัดไป<i class="fas fa-chevron-right ms-2"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>
