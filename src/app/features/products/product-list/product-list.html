<!-- product-list.html -->
<app-header></app-header>
<div class="container-fluid mt-2 content-wrapper">
  <!-- Compact Toolbar: Stats + Search + Actions -->
  <div class="toolbar-section mb-2">
    <div class="row g-2 align-items-center">
      <!-- Stats - ใช้ข้อมูลจริง -->
      <div class="col-auto">
        <div class="stats-inline">
          <i class="fas fa-boxes text-primary"></i>
          <span class="stats-value">{{ allProducts().length }}</span>
          <span class="stats-text">สินค้า</span>
        </div>
      </div>
      <div class="col-auto">
        <div class="stats-inline">
          <i class="fas fa-layer-group text-success"></i>
          <span class="stats-value">{{ categories().length }}</span>
          <span class="stats-text">หมวดหมู่</span>
        </div>
      </div>

      <!-- Divider -->
      <div class="col-auto d-none d-md-block">
        <div class="toolbar-divider"></div>
      </div>

      <!-- Quick Search -->
      <div class="col-md-3 col-sm-12">
        <input
          type="text"
          class="form-control form-control-sm"
          placeholder="ค้นหาสินค้า, SKU..."
          [ngModel]="searchTerm()"
          (ngModelChange)="searchTerm.set($event)"
        />
      </div>

      <!-- Category Filter -->
      <div class="col-md-2 col-sm-6">
        <select
          class="form-select form-select-sm"
          [ngModel]="selectedCategory()"
          (ngModelChange)="selectedCategory.set($event)"
        >
          <option value="">ทุกหมวดหมู่</option>
          @for (category of categories(); track category.id) {
          <option [value]="category.name">
            {{ category.name }}
          </option>
          }
        </select>
      </div>

      <!-- Status Filter -->
      <div class="col-md-2 col-sm-6">
        <select
          class="form-select form-select-sm"
          [ngModel]="selectedStatus()"
          (ngModelChange)="selectedStatus.set($event)"
        >
          <option value="">ทุกสถานะ</option>
          <option value="active">เปิดใช้งาน</option>
          <option value="outofstock">สินค้าหมด</option>
        </select>
      </div>

      <!-- Clear Filter Button -->
      <div class="col-md-2 col-sm-7">
        <button
          class="btn btn-outline-secondary btn-sm"
          (click)="clearFilters()"
          [disabled]="!searchTerm() && !selectedCategory() && !selectedStatus()"
        >
          <i class="fas fa-times me-1"></i>ล้างตัวกรอง
        </button>
      </div>

      <!-- Actions -->
      <div class="col-auto ms-auto">
        <button
          class="btn btn-success btn-sm"
          (click)="productFormModal.openModal()"
        >
          <i class="fas fa-plus me-1"></i>เพิ่มสินค้า
        </button>
      </div>
    </div>
  </div>

  <!-- Product Grid -->
  <div class="row">
    @for (product of products(); track product.id) {
    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
      <div class="product-card">
        <!-- Product Image -->
        <div class="product-image-wrapper">
          @if (!product.imageUrl) {
          <div class="product-image-placeholder">
            <i class="fas fa-box"></i>
          </div>
          } @if (product.imageUrl) {
          <img
            [src]="product.imageUrl"
            class="product-image"
            [alt]="product.name"
          />
          }

          <!-- Status Badge -->
          <span
            class="badge badge-status"
            [ngClass]="{
              'badge-stock-in': product.stock > (product.minStock || 0),
              'badge-stock-low':
                product.stock > 0 && product.stock <= (product.minStock || 0),
              'badge-stock-out': product.stock === 0
            }"
          >
            <i
              class="fas"
              [ngClass]="{
                'fa-check-circle': product.stock > (product.minStock || 0),
                'fa-exclamation-triangle':
                  product.stock > 0 && product.stock <= (product.minStock || 0),
                'fa-times-circle': product.stock === 0
              }"
              class="me-1"
            ></i>
            @if (product.stock > (product.minStock || 0)) {
            <span>เปิดใช้งาน</span>
            } @if (product.stock > 0 && product.stock <= (product.minStock ||
            0)) {
            <span>คงเหลือต่ำ</span>
            } @if (product.stock === 0) {
            <span>สินค้าหมด</span>
            }
          </span>
        </div>

        <div class="product-body">
          <!-- Category & SKU -->
          <div class="mb-2">
            <span class="category-badge">
              <i class="fas fa-layer-group me-1"></i>{{ product.category }}
            </span>
            <small class="product-sku ms-2">
              <i class="fas fa-hashtag me-1"></i>{{ product.sku }}
            </small>
          </div>

          <!-- Product Name -->
          <h5 class="product-title">{{ product.name }}</h5>

          <!-- Description -->
          @if (product.description) {
          <p class="product-description">
            {{ product.description }}
          </p>
          }

          <!-- Price & Stock -->
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="price-tag"
              >฿{{
                product.price.toLocaleString("th-TH", {
                  minimumFractionDigits: 2,
                  maximumFractionDigits: 2
                })
              }}</span
            >
            <span
              class="badge"
              [ngClass]="{
                'badge-stock-in': product.stock > (product.minStock || 0),
                'badge-stock-low':
                  product.stock > 0 && product.stock <= (product.minStock || 0),
                'badge-stock-out': product.stock === 0
              }"
            >
              <i
                class="fas me-1"
                [ngClass]="{
                  'fa-box': product.stock > (product.minStock || 0),
                  'fa-exclamation-triangle':
                    product.stock > 0 &&
                    product.stock <= (product.minStock || 0),
                  'fa-ban': product.stock === 0
                }"
              ></i>
              {{ product.stock }}
            </span>
          </div>

          <!-- Edit Button -->
          <button
            class="btn btn-outline-primary btn-sm w-100"
            (click)="onEditProduct(product.id!)"
          >
            <i class="fas fa-edit me-1"></i>แก้ไข
          </button>
        </div>
      </div>
    </div>
    }

    <!-- Empty State -->
    @if (products().length === 0) {
    <div class="col-12 text-center py-5">
      <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
      @if (searchTerm() || selectedCategory() || selectedStatus()) {
      <h5 class="text-muted">ไม่พบสินค้าที่ตรงกับเงื่อนไข</h5>
      <p class="text-muted">ลองเปลี่ยนตัวกรองหรือค้นหาใหม่</p>
      <button class="btn btn-outline-primary btn-sm" (click)="clearFilters()">
        <i class="fas fa-times me-1"></i>ล้างตัวกรอง
      </button>
      } @else {
      <h5 class="text-muted">ยังไม่มีสินค้า</h5>
      <p class="text-muted">คลิกปุ่ม "เพิ่มสินค้า" เพื่อเริ่มต้น</p>
      }
    </div>
    }
  </div>

  <!-- Pagination -->
  <div class="row mt-4 mb-4">
    <div class="col-12">
      <nav>
        <ul class="pagination pagination-sm justify-content-center">
          <li class="page-item disabled">
            <a class="page-link">
              <i class="fas fa-chevron-left me-1"></i>ก่อนหน้า
            </a>
          </li>
          <li class="page-item active">
            <a class="page-link">1</a>
          </li>
          <li class="page-item">
            <a class="page-link">2</a>
          </li>
          <li class="page-item">
            <a class="page-link">3</a>
          </li>
          <li class="page-item">
            <a class="page-link">4</a>
          </li>
          <li class="page-item">
            <a class="page-link">5</a>
          </li>
          <li class="page-item">
            <a class="page-link">
              ถัดไป<i class="fas fa-chevron-right ms-1"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- Product Form Modal -->
<app-product-form-modal
  #productModal
  (save)="onSaveProduct($event)"
  (cancel)="onCancelProduct()"
></app-product-form-modal>
