<!-- product-form.component.html - SIGNAL-BASED VERSION -->
<app-header></app-header>
<div class="container-fluid mt-4 content-wrapper">
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="page-header-glass">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h2 class="page-title">
              <i class="fas {{ isEditMode() ? 'fa-edit' : 'fa-plus-circle' }} me-3"></i>
              {{ getPageTitle() }}
            </h2>
            <p class="page-subtitle">
              {{ isEditMode() ? 'แก้ไขข้อมูลสินค้า' : 'กรอกข้อมูลสินค้าใหม่ในระบบ' }}
            </p>
          </div>
          <button class="btn btn-premium btn-premium-outline" (click)="cancel()">
            <i class="fas fa-arrow-left me-2"></i>กลับ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Form Content -->
  <div class="row">
    <div class="col-lg-8 mx-auto">
      <div class="form-glass">
        <!-- Alert Messages -->
        @if (submitMessage()) {
          <div
            class="alert"
            [ngClass]="{
              'alert-success': submitMessageType() === 'success',
              'alert-danger': submitMessageType() === 'error'
            }"
            role="alert"
          >
            <i class="fas {{ submitMessageType() === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle' }} me-2"></i>
            {{ submitMessage() }}
          </div>
        }

        <form (ngSubmit)="handleSubmit()">
          <div class="row">
            <!-- Product Name -->
            <div class="col-md-6 mb-3">
              <label class="form-label-glass">
                <i class="fas fa-tag me-2"></i>ชื่อสินค้า <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control-glass"
                placeholder="ระบุชื่อสินค้า"
                [value]="formData().name"
                (input)="updateField('name', $any($event.target).value)"
                required
              />
            </div>

            <!-- SKU -->
            <div class="col-md-6 mb-3">
              <label class="form-label-glass">
                <i class="fas fa-barcode me-2"></i>รหัสสินค้า (SKU) <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control-glass"
                placeholder="เช่น LAP-001"
                [value]="formData().sku"
                (input)="updateField('sku', $any($event.target).value)"
                required
              />
            </div>

            <!-- Category -->
            <div class="col-md-6 mb-3">
              <label class="form-label-glass">
                <i class="fas fa-layer-group me-2"></i>หมวดหมู่ <span class="text-danger">*</span>
              </label>
              <select
                class="form-select-glass"
                [value]="formData().category"
                (change)="updateCategory($any($event.target).value)"
                required
              >
                @for (cat of categories; track cat.value) {
                  <option [value]="cat.value">
                    {{ cat.value }}
                  </option>
                }
              </select>
            </div>

            <!-- Status -->
            <div class="col-md-6 mb-3">
              <label class="form-label-glass">
                <i class="fas fa-toggle-on me-2"></i>สถานะ <span class="text-danger">*</span>
              </label>
              <select
                class="form-select-glass"
                [value]="formData().status"
                (change)="updateField('status', $any($event.target).value)"
                required
              >
                <option value="active">เปิดใช้งาน</option>
                <option value="inactive">ปิดใช้งาน</option>
                <option value="out-of-stock">สินค้าหมด</option>
              </select>
            </div>

            <!-- Description -->
            <div class="col-12 mb-3">
              <label class="form-label-glass">
                <i class="fas fa-align-left me-2"></i>รายละเอียดสินค้า <span class="text-danger">*</span>
              </label>
              <textarea
                class="form-control-glass"
                rows="3"
                placeholder="ระบุรายละเอียดสินค้า"
                [value]="formData().description"
                (input)="updateField('description', $any($event.target).value)"
                required
              ></textarea>
            </div>

            <!-- Price -->
            <div class="col-md-6 mb-3">
              <label class="form-label-glass">
                <i class="fas fa-money-bill-wave me-2"></i>ราคา (บาท) <span class="text-danger">*</span>
              </label>
              <input
                type="number"
                class="form-control-glass"
                placeholder="0.00"
                min="0"
                step="0.01"
                [value]="formData().price"
                (input)="updateField('price', parseFloat($any($event.target).value) || 0)"
                required
              />
            </div>

            <!-- Stock -->
            <div class="col-md-6 mb-3">
              <label class="form-label-glass">
                <i class="fas fa-box me-2"></i>จำนวนสต็อก <span class="text-danger">*</span>
              </label>
              <input
                type="number"
                class="form-control-glass"
                placeholder="0"
                min="0"
                [value]="formData().stock"
                (input)="updateField('stock', parseInt($any($event.target).value) || 0)"
                required
              />
            </div>

            <!-- Image URL -->
            <div class="col-12 mb-3">
              <label class="form-label-glass">
                <i class="fas fa-image me-2"></i>URL รูปภาพ
              </label>
              <input
                type="url"
                class="form-control-glass"
                placeholder="https://example.com/image.jpg"
                [value]="formData().imageUrl"
                (input)="updateField('imageUrl', $any($event.target).value)"
              />
              @if (formData().imageUrl) {
                <div class="mt-3">
                  <img
                    [src]="formData().imageUrl"
                    alt="Preview"
                    class="img-preview"
                    (error)="$any($event.target).src = 'https://via.placeholder.com/300x250/667eea/ffffff?text=No+Image'"
                  />
                </div>
              }
            </div>
          </div>

          <!-- Form Actions -->
          <div class="row mt-4">
            <div class="col-12">
              <div class="d-flex gap-2 justify-content-end">
                <button
                  type="button"
                  class="btn btn-premium btn-premium-outline"
                  (click)="cancel()"
                  [disabled]="isSubmitting()"
                >
                  <i class="fas fa-times me-2"></i>ยกเลิก
                </button>

                @if (!isEditMode()) {
                  <button
                    type="button"
                    class="btn btn-premium btn-premium-outline"
                    (click)="resetForm()"
                    [disabled]="isSubmitting()"
                  >
                    <i class="fas fa-redo me-2"></i>ล้างข้อมูล
                  </button>
                }

                <button
                  type="submit"
                  class="btn btn-premium btn-premium-success"
                  [disabled]="!isFormValid() || isSubmitting()"
                >
                  <i class="fas {{ isSubmitting() ? 'fa-spinner fa-spin' : (isEditMode() ? 'fa-save' : 'fa-plus-circle') }} me-2"></i>
                  {{ getSubmitButtonText() }}
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Form Info Card -->
      <div class="info-card mt-4">
        <h5 class="mb-3">
          <i class="fas fa-info-circle me-2"></i>ข้อมูลฟอร์ม
        </h5>
        <div class="row">
          <div class="col-md-6">
            <p><strong>โหมด:</strong> {{ isEditMode() ? 'แก้ไข' : 'เพิ่มใหม่' }}</p>
            <p><strong>สถานะฟอร์ม:</strong> {{ isFormValid() ? '✓ พร้อมบันทึก' : '✗ ข้อมูลไม่ครบ' }}</p>
          </div>
          <div class="col-md-6">
            @if (isEditMode()) {
              <p><strong>Product ID:</strong> {{ productId() }}</p>
            }
            <p><strong>หมวดหมู่:</strong> {{ formData().category }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
