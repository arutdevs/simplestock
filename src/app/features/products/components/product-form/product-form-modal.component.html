<!-- product-form-modal.component.html -->
<div class="modal fade" id="productFormModal" tabindex="-1" aria-labelledby="productFormModalLabel" aria-hidden="true" data-bs-backdrop="static">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title" id="productFormModalLabel">
          <i class="fas fa-plus-circle me-2"></i>
          {{ isEditMode ? 'แก้ไขสินค้า' : 'เพิ่มสินค้าใหม่' }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <form [formGroup]="productForm" id="productFormId">
          <div class="row g-3">
            <!-- SKU -->
            <div class="col-md-6">
              <label for="sku" class="form-label required">
                <i class="fas fa-barcode me-1"></i>รหัสสินค้า (SKU)
              </label>
              <input
                type="text"
                class="form-control"
                id="sku"
                formControlName="sku"
                placeholder="เช่น LAP-001"
                [class.is-invalid]="isFieldInvalid('sku')"
              />
              <div class="invalid-feedback" *ngIf="isFieldInvalid('sku')">
                <span *ngIf="productForm.get('sku')?.errors?.['required']">กรุณากรอกรหัสสินค้า</span>
                <span *ngIf="productForm.get('sku')?.errors?.['minlength']">รหัสสินค้าต้องมีอย่างน้อย 3 ตัวอักษร</span>
              </div>
            </div>

            <!-- ชื่อสินค้า -->
            <div class="col-md-6">
              <label for="name" class="form-label required">
                <i class="fas fa-tag me-1"></i>ชื่อสินค้า
              </label>
              <input
                type="text"
                class="form-control"
                id="name"
                formControlName="name"
                placeholder="เช่น โน้ตบุ๊ค Dell Inspiron"
                [class.is-invalid]="isFieldInvalid('name')"
              />
              <div class="invalid-feedback" *ngIf="isFieldInvalid('name')">
                <span *ngIf="productForm.get('name')?.errors?.['required']">กรุณากรอกชื่อสินค้า</span>
                <span *ngIf="productForm.get('name')?.errors?.['minlength']">ชื่อสินค้าต้องมีอย่างน้อย 3 ตัวอักษร</span>
              </div>
            </div>

            <!-- รายละเอียด -->
            <div class="col-12">
              <label for="description" class="form-label">
                <i class="fas fa-align-left me-1"></i>รายละเอียด
              </label>
              <textarea
                class="form-control"
                id="description"
                formControlName="description"
                rows="3"
                placeholder="รายละเอียดเพิ่มเติมเกี่ยวกับสินค้า..."
              ></textarea>
            </div>

            <!-- หมวดหมู่ -->
            <div class="col-md-6">
              <label for="category" class="form-label required">
                <i class="fas fa-layer-group me-1"></i>หมวดหมู่
              </label>
              <select
                class="form-select"
                id="category"
                formControlName="category"
                [class.is-invalid]="isFieldInvalid('category')"
              >
                <option value="">-- เลือกหมวดหมู่ --</option>
                <option value="อิเล็กทรอนิกส์">อิเล็กทรอนิกส์</option>
                <option value="เสื้อผ้า">เสื้อผ้า</option>
                <option value="อาหารและเครื่องดื่ม">อาหารและเครื่องดื่ม</option>
                <option value="เครื่องใช้ในบ้าน">เครื่องใช้ในบ้าน</option>
                <option value="เครื่องเขียน">เครื่องเขียน</option>
                <option value="อื่นๆ">อื่นๆ</option>
              </select>
              <div class="invalid-feedback" *ngIf="isFieldInvalid('category')">
                กรุณาเลือกหมวดหมู่
              </div>
            </div>

            <!-- หน่วยนับ -->
            <div class="col-md-6">
              <label for="unit" class="form-label required">
                <i class="fas fa-cube me-1"></i>หน่วยนับ
              </label>
              <select
                class="form-select"
                id="unit"
                formControlName="unit"
                [class.is-invalid]="isFieldInvalid('unit')"
              >
                <option value="">-- เลือกหน่วย --</option>
                <option value="ชิ้น">ชิ้น</option>
                <option value="กล่อง">กล่อง</option>
                <option value="แพ็ค">แพ็ค</option>
                <option value="กิโลกรัม">กิโลกรัม</option>
                <option value="ลิตร">ลิตร</option>
                <option value="เมตร">เมตร</option>
                <option value="เซ็ต">เซ็ต</option>
              </select>
              <div class="invalid-feedback" *ngIf="isFieldInvalid('unit')">
                กรุณาเลือกหน่วยนับ
              </div>
            </div>

            <!-- ราคาทุน -->
            <div class="col-md-4">
              <label for="cost" class="form-label">
                <i class="fas fa-dollar-sign me-1"></i>ราคาทุน
              </label>
              <input
                type="number"
                class="form-control"
                id="cost"
                formControlName="cost"
                placeholder="0.00"
                min="0"
                step="0.01"
              />
            </div>

            <!-- ราคาขาย -->
            <div class="col-md-4">
              <label for="price" class="form-label required">
                <i class="fas fa-tags me-1"></i>ราคาขาย
              </label>
              <input
                type="number"
                class="form-control"
                id="price"
                formControlName="price"
                placeholder="0.00"
                min="0"
                step="0.01"
                [class.is-invalid]="isFieldInvalid('price')"
              />
              <div class="invalid-feedback" *ngIf="isFieldInvalid('price')">
                <span *ngIf="productForm.get('price')?.errors?.['required']">กรุณากรอกราคาขาย</span>
                <span *ngIf="productForm.get('price')?.errors?.['min']">ราคาต้องมากกว่า 0</span>
              </div>
            </div>

            <!-- กำไร (คำนวณอัตโนมัติ) -->
            <div class="col-md-4">
              <label class="form-label">
                <i class="fas fa-chart-line me-1"></i>กำไร
              </label>
              <input
                type="text"
                class="form-control"
                [value]="calculateProfit()"
                readonly
                disabled
              />
            </div>

            <!-- จำนวนคงเหลือ -->
            <div class="col-md-6">
              <label for="stock" class="form-label required">
                <i class="fas fa-boxes me-1"></i>จำนวนคงเหลือ
              </label>
              <input
                type="number"
                class="form-control"
                id="stock"
                formControlName="stock"
                placeholder="0"
                min="0"
                [class.is-invalid]="isFieldInvalid('stock')"
              />
              <div class="invalid-feedback" *ngIf="isFieldInvalid('stock')">
                <span *ngIf="productForm.get('stock')?.errors?.['required']">กรุณากรอกจำนวนคงเหลือ</span>
                <span *ngIf="productForm.get('stock')?.errors?.['min']">จำนวนต้องมากกว่าหรือเท่ากับ 0</span>
              </div>
            </div>

            <!-- จำนวนขั้นต่ำ -->
            <div class="col-md-6">
              <label for="minStock" class="form-label">
                <i class="fas fa-exclamation-triangle me-1"></i>จำนวนขั้นต่ำ (แจ้งเตือน)
              </label>
              <input
                type="number"
                class="form-control"
                id="minStock"
                formControlName="minStock"
                placeholder="0"
                min="0"
              />
              <small class="text-muted">ระบบจะแจ้งเตือนเมื่อสินค้าเหลือต่ำกว่านี้</small>
            </div>

            <!-- บาร์โค้ด -->
            <div class="col-md-6">
              <label for="barcode" class="form-label">
                <i class="fas fa-qrcode me-1"></i>บาร์โค้ด
              </label>
              <input
                type="text"
                class="form-control"
                id="barcode"
                formControlName="barcode"
                placeholder="เช่น 8858123456789"
              />
            </div>

            <!-- อัปโหลดรูปภาพ -->
            <div class="col-12">
              <label for="imageFile" class="form-label">
                <i class="fas fa-image me-1"></i>รูปภาพสินค้า
              </label>

              <!-- Upload Area -->
              <div class="upload-area" *ngIf="!imagePreview">
                <div class="upload-area-content">
                  <i class="fas fa-cloud-upload-alt upload-icon"></i>
                  <p class="upload-text">คลิกเพื่อเลือกรูปภาพ</p>
                  <p class="upload-hint">รองรับไฟล์: JPG, PNG, GIF (ขนาดไม่เกิน 5MB)</p>
                  <input
                    type="file"
                    class="form-control file-input"
                    id="imageFile"
                    (change)="onFileSelected($event)"
                    accept="image/*"
                  />
                </div>
              </div>

              <!-- Image Preview -->
              <div *ngIf="imagePreview" class="image-preview-wrapper">
                <div class="image-preview-container">
                  <div class="image-preview-box">
                    <img [src]="imagePreview" alt="Preview" />
                  </div>
                  <div class="image-preview-actions">
                    <button type="button" class="btn btn-danger btn-sm" (click)="removeImage()">
                      <i class="fas fa-trash me-1"></i>ลบรูปภาพ
                    </button>
                    <label for="imageFile" class="btn btn-outline-primary btn-sm mb-0">
                      <i class="fas fa-sync-alt me-1"></i>เปลี่ยนรูปภาพ
                    </label>
                    <input
                      type="file"
                      class="d-none"
                      id="imageFile"
                      (change)="onFileSelected($event)"
                      accept="image/*"
                    />
                  </div>
                </div>
              </div>
            </div>

            <!-- สถานะการใช้งาน -->
            <div class="col-12">
              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="isActive"
                  formControlName="isActive"
                />
                <label class="form-check-label" for="isActive">
                  <i class="fas fa-toggle-on me-1"></i>เปิดใช้งานสินค้า
                </label>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" (click)="onClear()">
          <i class="fas fa-eraser me-1"></i>เคลียร์ข้อมูล
        </button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i>ยกเลิก
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          (click)="onSubmit()"
          [disabled]="productForm.invalid"
        >
          <i class="fas fa-save me-1"></i>
          {{ isEditMode ? 'บันทึกการแก้ไข' : 'บันทึกสินค้า' }}
        </button>
      </div>
    </div>
  </div>
</div>
